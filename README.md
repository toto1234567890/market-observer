** generated by IA

# MarketObserver

**MarketObserver** is a high-performance, asynchronous market surveillance system designed to track real-time stock data, aggregate it into custom timeframes, and detect statistical anomalies using efficient numerical methods.

## ğŸš€ Features

- **Real-Time Tracking**: Fetches datas (5-minute intervals) for multiple symbols concurrently.
- **High Performance**:
    - **Async I/O**: Fully asynchronous architecture using `asyncio` and `aiohttp`.
    - **Numpy Ring Buffers**: Custom memory management using fixed-size `float64` ring buffers for O(1) inserts and minimal memory footprint.
    - **Vectorized Analysis**: All heavy calculations (resampling, correlation, aggregation) use `numpy` vectorization.
    - **Parallel Processing**: Initial data loading, stats calculation, and database writes are parallelized.
- **Advanced Analysis**:
    - **Volume Anomaly Detection**: Compares real-time volume against historical baselines (Z-score/Ratio).
    - **Price-Volume Correlation**: Pearson correlation to detect price trends supported by volume.
- **Modern Dashboard**:
    - **FastAPI & WebSockets**: Low-latency real-time updates pushed to the client.
    - **Interactive UI**: Responsive grid layout, dark mode, and dynamic metric cards.
- **Robust Storage**:
    - **Async SQLite**: with dynamic batch sizing and concurrent writes to handle high throughput.
    - **Automatic Cleanup**: Periodic data pruning based on configurable retention policies.

## ğŸ— Architecture

The application follows a modular, component-based architecture:

- **`MarketObserver` (Main)**: The central orchestrator managing the event loop, data ingestion, and component lifecycle.
- **`MemoryManager`**: uses `NumpyRingBuffer` to store time-series data efficiently in RAM.
- **`Analysis Module`**:
    - `Aggregator`: Facade for managing multi-window aggregations.
    - `Processing`: Handles core data resampling and OHLCV candle generation.
    - `Statistics`: Computes historical baselines for anomaly detection.
    - `Volume`: Centralized validation and calculation logic.
- **`Storage`**: `AsyncSQLiteDB` with smart batching (auto-calculated based on SQLite variable limits).
- **`Server`**: `FastAPIServer` providing HTML assets and a WebSocket endpoint for live data broadcasting.

## ğŸ§® Methodologies

### 1. Data Pipeline
1.  **Ingest**: Fetch raw 5m snapshot from Data Source (Yahoo Finance).
2.  **Buffer**: Push to `NumpyRingBuffer` (Memory).
3.  **Persist**: Asynchronously batch write to SQLite.
4.  **Broadcast**: Push raw update to WebSocket clients.

### 2. Window Aggregation
We aggregate 5m base data into larger windows (e.g., 15m, 1h, 4h).
- **Resampling**: Timestamps are grouped into buckets using vectorized numpy operations.
- **Metrics**:
    - **Volume**: Sum of underlying candles.
    - **Volatility**: Standard deviation of price changes.
    - **Anomaly Ratio**: `Current Volume / Historical Average Volume`.

## ğŸ›  Usage

### Prerequisites
- Python 3.9+
- `pip install -r requirements.txt`
  - `numpy`, `pandas`, `aiohttp`, `aiosqlite`, `fastapi`, `uvicorn`, `jinja2`, `exchange_calendars`, `psutil`.

### Running the App
```bash
python main.py
```
The dashboard will be available at `http://127.0.0.1:8000`.

### Configuration
Managed via `config/default.yaml`:
```yaml
# Example settings
SYMBOLS: ["AAPL", "MSFT", "GOOGL", "NVDA"]
WINDOWS_AGGREGATION: ["15m", "1h", "4h"]
RETENTION_DAYS: 7
```

## ğŸ“‚ Project Structure
```
â”œâ”€â”€ main.py                  # Application entry point & controller
â”œâ”€â”€ config/                  # Configuration files
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ analysis/            # Mathematical core
â”‚   â”‚   â”œâ”€â”€ aggregator.py    # Multi-window coordination
â”‚   â”‚   â”œâ”€â”€ processing.py    # Resampling & Candle logic
â”‚   â”‚   â”œâ”€â”€ statistics.py    # Historical stats
â”‚   â”‚   â””â”€â”€ volume.py        # Volume utils
â”‚   â”œâ”€â”€ data_source/         # External API integrations
â”‚   â”œâ”€â”€ helpers/             # Error handling & logging
â”‚   â”œâ”€â”€ interfaces/          # Abstract Base Classes
â”‚   â”œâ”€â”€ network/             # Async HTTP client
â”‚   â”œâ”€â”€ server/              # FastAPI & WebSocket logic
â”‚   â”œâ”€â”€ storage/             # Database implementations
â”‚   â””â”€â”€ utils/               # RingBuffer, Scheduler, MemoryManager
â””â”€â”€ README.md
```
